<?xml version="1.0" encoding="UTF-8"?>
<REPOSITORY
   NAME="Siebel Repository"
   UPDATED="08/11/2017 16:02:15"
   UPDATED_BY="SADMIN"
   CREATED="08/11/2017 11:53:44"
   CREATED_BY="SADMIN"
   FIO_PLACEHOLDER_FIO="TRUE">
	<PROJECT
	   ALLOW_OBJECT_LOCKING="Y"
	   INACTIVE="N"
	   LOCKED="N"
	   NAME="VFTRAD Digital Id"
	   UI_FREEZE="N"
	   UPDATED="04/19/2018 02:27:13"
	   UPDATED_BY="IBM_BAKIG"
	   CREATED="04/10/2018 11:43:55"
	   CREATED_BY="IBM_BAKIG"
	   FIO_PLACEHOLDER_FIO="TRUE">
		<BUSINESS_SERVICE
		   CACHE="N"
		   CLASS="CSSService"
		   COMMENTS="DigitalID"
		   EXTERNAL_USE="N"
		   HIDDEN="N"
		   INACTIVE="N"
		   NAME="VF GetOrderTransData"
		   OBJECT_LOCKED="N"
		   SERVER_ENABLED="N"
		   STATE_MANAGEMENT_TYPE="Stateful"
		   WEB_SERVICE_ENABLED="N"
		   UPDATED="04/19/2018 02:44:37"
		   UPDATED_BY="IBM_BAKIG"
		   CREATED="04/10/2018 11:44:00"
		   CREATED_BY="IBM_BAKIG">
			<BUSINESS_SERVICE_METHOD
			   HIDDEN="N"
			   INACTIVE="N"
			   NAME="GetOrderTransData"
			   UPDATED="04/10/2018 11:44:00"
			   UPDATED_BY="IBM_BAKIG"
			   CREATED="04/10/2018 11:44:00"
			   CREATED_BY="IBM_BAKIG">
				<BUSINESS_SERVICE_METHOD_ARG
				   DATA_TYPE="String"
				   HIDDEN="N"
				   INACTIVE="N"
				   NAME="Billing_Account"
				   OPTIONAL="Y"
				   STORAGE_TYPE="Property"
				   TYPE="Input"
				   UPDATED="04/10/2018 11:44:00"
				   UPDATED_BY="IBM_BAKIG"
				   CREATED="04/10/2018 11:44:00"
				   CREATED_BY="IBM_BAKIG">
					<BUSINESS_SERVICE_METHOD_ARG_LOCALE
					   APPLICATION_CODE="STD"
					   DISPLAY_NAME="Billing_Account"
					   INACTIVE="N"
					   LANGUAGE_CODE="ENU"
					   NAME="ENU-STD"
					   TRANSLATE="Y"
					   UPDATED="04/10/2018 11:44:00"
					   UPDATED_BY="IBM_BAKIG"
					   CREATED="04/10/2018 11:44:00"
					   CREATED_BY="IBM_BAKIG">
					</BUSINESS_SERVICE_METHOD_ARG_LOCALE>
				</BUSINESS_SERVICE_METHOD_ARG>
				<BUSINESS_SERVICE_METHOD_ARG
				   DATA_TYPE="String"
				   HIDDEN="N"
				   INACTIVE="N"
				   NAME="ErrorCode"
				   OPTIONAL="Y"
				   STORAGE_TYPE="Property"
				   TYPE="Output"
				   UPDATED="04/10/2018 11:44:00"
				   UPDATED_BY="IBM_BAKIG"
				   CREATED="04/10/2018 11:44:00"
				   CREATED_BY="IBM_BAKIG">
					<BUSINESS_SERVICE_METHOD_ARG_LOCALE
					   APPLICATION_CODE="STD"
					   DISPLAY_NAME="ErrorCode"
					   INACTIVE="N"
					   LANGUAGE_CODE="ENU"
					   NAME="ENU-STD"
					   TRANSLATE="Y"
					   UPDATED="04/10/2018 11:44:00"
					   UPDATED_BY="IBM_BAKIG"
					   CREATED="04/10/2018 11:44:00"
					   CREATED_BY="IBM_BAKIG">
					</BUSINESS_SERVICE_METHOD_ARG_LOCALE>
				</BUSINESS_SERVICE_METHOD_ARG>
				<BUSINESS_SERVICE_METHOD_ARG
				   DATA_TYPE="String"
				   HIDDEN="N"
				   INACTIVE="N"
				   NAME="ErrorDescription"
				   OPTIONAL="Y"
				   STORAGE_TYPE="Property"
				   TYPE="Output"
				   UPDATED="04/10/2018 11:44:00"
				   UPDATED_BY="IBM_BAKIG"
				   CREATED="04/10/2018 11:44:00"
				   CREATED_BY="IBM_BAKIG">
					<BUSINESS_SERVICE_METHOD_ARG_LOCALE
					   APPLICATION_CODE="STD"
					   DISPLAY_NAME="ErrorDescription"
					   INACTIVE="N"
					   LANGUAGE_CODE="ENU"
					   NAME="ENU-STD"
					   TRANSLATE="Y"
					   UPDATED="04/10/2018 11:44:00"
					   UPDATED_BY="IBM_BAKIG"
					   CREATED="04/10/2018 11:44:00"
					   CREATED_BY="IBM_BAKIG">
					</BUSINESS_SERVICE_METHOD_ARG_LOCALE>
				</BUSINESS_SERVICE_METHOD_ARG>
				<BUSINESS_SERVICE_METHOD_ARG
				   DATA_TYPE="Integration Object"
				   HIDDEN="N"
				   INACTIVE="N"
				   INTEGRATION_OBJECT="GetOrderTransDataOutput"
				   NAME="GetOrderTransDataOutput"
				   OPTIONAL="Y"
				   STORAGE_TYPE="Hierarchy"
				   TYPE="Output"
				   UPDATED="04/10/2018 11:44:00"
				   UPDATED_BY="IBM_BAKIG"
				   CREATED="04/10/2018 11:44:00"
				   CREATED_BY="IBM_BAKIG">
					<BUSINESS_SERVICE_METHOD_ARG_LOCALE
					   APPLICATION_CODE="STD"
					   DISPLAY_NAME="GetOrderTransDataOutput"
					   INACTIVE="N"
					   LANGUAGE_CODE="ENU"
					   NAME="ENU-STD"
					   TRANSLATE="Y"
					   UPDATED="04/10/2018 11:44:00"
					   UPDATED_BY="IBM_BAKIG"
					   CREATED="04/10/2018 11:44:00"
					   CREATED_BY="IBM_BAKIG">
					</BUSINESS_SERVICE_METHOD_ARG_LOCALE>
				</BUSINESS_SERVICE_METHOD_ARG>
				<BUSINESS_SERVICE_METHOD_ARG
				   DATA_TYPE="String"
				   HIDDEN="N"
				   INACTIVE="N"
				   NAME="Msisdn"
				   OPTIONAL="Y"
				   STORAGE_TYPE="Property"
				   TYPE="Input"
				   UPDATED="04/10/2018 11:44:00"
				   UPDATED_BY="IBM_BAKIG"
				   CREATED="04/10/2018 11:44:00"
				   CREATED_BY="IBM_BAKIG">
					<BUSINESS_SERVICE_METHOD_ARG_LOCALE
					   APPLICATION_CODE="STD"
					   DISPLAY_NAME="Msisdn"
					   INACTIVE="N"
					   LANGUAGE_CODE="ENU"
					   NAME="ENU-STD"
					   TRANSLATE="Y"
					   UPDATED="04/10/2018 11:44:00"
					   UPDATED_BY="IBM_BAKIG"
					   CREATED="04/10/2018 11:44:00"
					   CREATED_BY="IBM_BAKIG">
					</BUSINESS_SERVICE_METHOD_ARG_LOCALE>
				</BUSINESS_SERVICE_METHOD_ARG>
				<BUSINESS_SERVICE_METHOD_ARG
				   DATA_TYPE="String"
				   HIDDEN="N"
				   INACTIVE="N"
				   NAME="Shop_Code"
				   OPTIONAL="Y"
				   STORAGE_TYPE="Property"
				   TYPE="Input"
				   UPDATED="04/10/2018 11:44:00"
				   UPDATED_BY="IBM_BAKIG"
				   CREATED="04/10/2018 11:44:00"
				   CREATED_BY="IBM_BAKIG">
					<BUSINESS_SERVICE_METHOD_ARG_LOCALE
					   APPLICATION_CODE="STD"
					   DISPLAY_NAME="Shop_Code"
					   INACTIVE="N"
					   LANGUAGE_CODE="ENU"
					   NAME="ENU-STD"
					   TRANSLATE="Y"
					   UPDATED="04/10/2018 11:44:00"
					   UPDATED_BY="IBM_BAKIG"
					   CREATED="04/10/2018 11:44:00"
					   CREATED_BY="IBM_BAKIG">
					</BUSINESS_SERVICE_METHOD_ARG_LOCALE>
				</BUSINESS_SERVICE_METHOD_ARG>
				<BUSINESS_SERVICE_METHOD_ARG
				   DATA_TYPE="String"
				   HIDDEN="N"
				   INACTIVE="N"
				   NAME="StatusCode"
				   OPTIONAL="Y"
				   STORAGE_TYPE="Property"
				   TYPE="Output"
				   UPDATED="04/10/2018 11:44:00"
				   UPDATED_BY="IBM_BAKIG"
				   CREATED="04/10/2018 11:44:00"
				   CREATED_BY="IBM_BAKIG">
					<BUSINESS_SERVICE_METHOD_ARG_LOCALE
					   APPLICATION_CODE="STD"
					   DISPLAY_NAME="StatusCode"
					   INACTIVE="N"
					   LANGUAGE_CODE="ENU"
					   NAME="ENU-STD"
					   TRANSLATE="Y"
					   UPDATED="04/10/2018 11:44:00"
					   UPDATED_BY="IBM_BAKIG"
					   CREATED="04/10/2018 11:44:00"
					   CREATED_BY="IBM_BAKIG">
					</BUSINESS_SERVICE_METHOD_ARG_LOCALE>
				</BUSINESS_SERVICE_METHOD_ARG>
				<BUSINESS_SERVICE_METHOD_ARG
				   DATA_TYPE="String"
				   HIDDEN="N"
				   INACTIVE="N"
				   NAME="tax_number"
				   OPTIONAL="Y"
				   STORAGE_TYPE="Property"
				   TYPE="Input"
				   UPDATED="04/10/2018 11:44:00"
				   UPDATED_BY="IBM_BAKIG"
				   CREATED="04/10/2018 11:44:00"
				   CREATED_BY="IBM_BAKIG">
					<BUSINESS_SERVICE_METHOD_ARG_LOCALE
					   APPLICATION_CODE="STD"
					   DISPLAY_NAME="tax_number"
					   INACTIVE="N"
					   LANGUAGE_CODE="ENU"
					   NAME="ENU-STD"
					   TRANSLATE="Y"
					   UPDATED="04/10/2018 11:44:00"
					   UPDATED_BY="IBM_BAKIG"
					   CREATED="04/10/2018 11:44:00"
					   CREATED_BY="IBM_BAKIG">
					</BUSINESS_SERVICE_METHOD_ARG_LOCALE>
				</BUSINESS_SERVICE_METHOD_ARG>
				<BUSINESS_SERVICE_METHOD_LOCALE
				   APPLICATION_CODE="STD"
				   DISPLAY_NAME="GetOrderTransData"
				   INACTIVE="N"
				   LANGUAGE_CODE="ENU"
				   NAME="ENU-STD"
				   TRANSLATE="Y"
				   UPDATED="04/10/2018 11:44:00"
				   UPDATED_BY="IBM_BAKIG"
				   CREATED="04/10/2018 11:44:00"
				   CREATED_BY="IBM_BAKIG">
				</BUSINESS_SERVICE_METHOD_LOCALE>
			</BUSINESS_SERVICE_METHOD>
			<BUSINESS_SERVICE_SERVER_SCRIPT
			   INACTIVE="N"
			   NAME="GetOrderTransData"
			   PROGRAM_LANGUAGE="JS"
			   SCRIPT="function GetOrderTransData (Inputs, Outputs){
	try{
		var record = &quot;&quot;;
		var msisdn = &quot;&quot;;
		var shop_code = &quot;&quot;;
		var tax_number = &quot;&quot;;
		var billing_account = &quot;&quot;;
		var checkEligibility = true;
		var errorCode = &quot;SBL-ROW&quot;;
		var errorDescription = &quot;No Row Returned!&quot;;
		var statusCode = &quot;1&quot;;
		var orderSearchSpec = &quot;&quot;;
		var orderItemSearchSpec = &quot;&quot;;
		var twoDays = TheApplication().InvokeMethod(&quot;LookupValue&quot;,&quot;VFTRAD_DIGITAL_ID&quot;, &quot;Days&quot;);
		var twoDayBefore =&quot;&quot;;
		var orderID = &quot;&quot;;
		var actionReason = &quot;&quot;;
		var isTaxNum = false;
		
		var orderOpen = TheApplication().InvokeMethod(&quot;LookupValue&quot;,&quot;FS_ORDER_STATUS&quot;, &quot;Open&quot;);
		var orderFailed = TheApplication().InvokeMethod(&quot;LookupValue&quot;,&quot;FS_ORDER_STATUS&quot;, &quot;Failed&quot;);
		var orderCompleted = TheApplication().InvokeMethod(&quot;LookupValue&quot;,&quot;FS_ORDER_STATUS&quot;, &quot;Complete&quot;);
		
		var orderItemDetails	: PropertySet;// = TheApplication().NewPropertySet();
		var orderItemList	: PropertySet = TheApplication().NewPropertySet();
		var orderItem	: PropertySet = TheApplication().NewPropertySet();
		
		//orderItemDetails.SetType(&quot;GetOrderTransDataOutput&quot;);
		orderItemList.SetType(&quot;ListOfGetOrderTransDataOutput&quot;);
		orderItem.SetType(&quot;GetOrderTransDataOutput&quot;);
		
		var orderBusObject = TheApplication().GetBusObject(&quot;Order Entry&quot;); //TELCO Order - Simple&quot;);//
		var orderBusComp = orderBusObject.GetBusComp(&quot;Order Entry - Orders&quot;); //TELCO Orders - Simple&quot;);//
		
		var inProp 	: PropertySet = TheApplication().NewPropertySet();
		var outProp	: PropertySet = TheApplication().NewPropertySet();
		var bsDateTime = TheApplication().GetService(&quot;TELCO DateTime Utils&quot;); 
		
		var inLOVProp : PropertySet = TheApplication().NewPropertySet();
		var outLOVProp : PropertySet = TheApplication().NewPropertySet();
		var bsLOV = TheApplication().GetService(&quot;TELCO BusComp Utils&quot;);
		
		var orderLineItemBusComp = orderBusObject.GetBusComp(&quot;Order Entry - Line Items&quot;);
		
		msisdn = Inputs.GetProperty(&quot;Msisdn&quot;);
		shop_code = Inputs.GetProperty(&quot;Shop_Code&quot;);
		tax_number = Inputs.GetProperty(&quot;tax_number&quot;);
		billing_account = Inputs.GetProperty(&quot;Billing_Account&quot;);
				
		if (shop_code == null || shop_code == &quot;&quot;){
			//return error
			statusCode = &quot;1&quot;
			errorCode = &quot;SBL-SHOP&quot;;
			errorDescription = &quot;Shop_Code input argument is missing!&quot;;
			checkEligibility = false;
		}
		else{
			orderSearchSpec = &quot;[VF Shop Code] = &apos;&quot;+shop_code+&quot;&apos; &quot; +orderSearchSpec;
	
			if(tax_number == null || tax_number == &quot;&quot;){
				if (msisdn == null || msisdn == &quot;&quot;){
					if(billing_account == null || billing_account == &quot;&quot; ){
						//return error
						statusCode = &quot;1&quot;
						errorCode = &quot;SBL-SUBINP&quot;;
						errorDescription = &quot;Msisdn, Billing_Account or tax_number should not be empty!&quot;;
						checkEligibility = false;
					}
					else{
						orderSearchSpec = &quot; [Billing Account Code] = &apos;&quot;+billing_account+&quot;&apos; AND &quot; +orderSearchSpec;
					}
				}
				else{
					orderSearchSpec = &quot; EXISTS([VF_MSISDN] = &apos;&quot;+msisdn+&quot;&apos;) AND  &quot; +orderSearchSpec; //&quot;+msisdn+&quot;
				}
			}
			else{
				orderSearchSpec = &quot; [CustTaxId] =&apos;&quot;+ tax_number +&quot;&apos; AND &quot; +orderSearchSpec; 
				isTaxNum = true;
			}
		}

		if (checkEligibility){

			inProp.SetProperty(&quot;dateIn&quot;,getFormatDate());
			inProp.SetProperty(&quot;dayDuration&quot;,twoDays); 
			
			bsDateTime.InvokeMethod(&quot;AddDaysToDate&quot;,inProp,outProp);
			twoDayBefore = outProp.GetProperty(&quot;dateOut&quot;);
			
			orderSearchSpec = &quot; ([Status] = &apos;&quot;+orderOpen+&quot;&apos; OR [Status] = &apos;&quot;+orderFailed+&quot;&apos; OR [Status] = &apos;&quot;+orderCompleted+&quot;&apos;) AND &quot; + orderSearchSpec;
			orderSearchSpec = &quot; [Created] &gt; &apos;&quot;+twoDayBefore+&quot;&apos; AND &quot; +orderSearchSpec;

			orderBusComp.ActivateField(&quot;VF_MSISDN&quot;);
			orderBusComp.ClearToQuery();
			orderBusComp.SetViewMode(AllView);	
			orderBusComp.SetSearchExpr(orderSearchSpec);
			
			orderBusComp.ExecuteQuery(ForwardOnly);
			record = orderBusComp.FirstRecord();
			
			while(record){
				orderID = orderBusComp.GetFieldValue(&quot;Id&quot;);
				msisdn = orderBusComp.GetFieldValue(&quot;VF_MSISDN&quot;);
				
				orderItemSearchSpec = &quot;[Order Header Id]= &apos;&quot;+orderID+&quot;&apos; AND [Root Order Item Id] = [Id] AND ([TELCO Action Reason LIC] &lt;&gt; &apos;106&apos; OR [TELCO Action Reason LIC] &lt;&gt; &apos;112&apos;)&quot;;
				
				orderLineItemBusComp.ActivateField(&quot;TELCO Action Reason&quot;);
				orderLineItemBusComp.ActivateField(&quot;TELCO Action Reason LIC&quot;);
				orderLineItemBusComp.ActivateField(&quot;Account&quot;);
				
				orderLineItemBusComp.ClearToQuery();
				orderLineItemBusComp.SetViewMode(AllView);	
				orderLineItemBusComp.SetSearchExpr(orderItemSearchSpec);
				
				orderLineItemBusComp.ExecuteQuery(ForwardOnly);
				
				var recordItem = orderLineItemBusComp.FirstRecord();
				
				if(recordItem){
				//while(recordItem){//Should return one record per order // design change
					orderItemDetails = TheApplication().NewPropertySet();
					orderItemDetails.SetType(&quot;GetOrderTransDataOutput&quot;);
					actionReason = orderLineItemBusComp.GetFieldValue(&quot;TELCO Action Reason LIC&quot;);
				
					inLOVProp.SetProperty(&quot;BusinessComponent&quot;,&quot;List Of Values&quot;);
					inLOVProp.SetProperty(&quot;BusinessObject&quot;,&quot;List Of Values&quot;);
					inLOVProp.SetProperty(&quot;Value&quot;,&quot;&quot;);
					inLOVProp.SetProperty(&quot;SearchExpression&quot;,&quot;[Type]=&apos;ACS_ORDER_REASON&apos; AND [Name]= &apos;&quot;+actionReason+&quot;&apos; AND [Language] = &apos;TRK&apos;&quot;);
					bsLOV.InvokeMethod(&quot;GetFieldsFromFirstRow&quot;,inLOVProp,outLOVProp);
				
					orderItemDetails.SetProperty(&quot;ActionType&quot;,outLOVProp.GetProperty(&quot;Value&quot;));
					orderItemDetails.SetProperty(&quot;ActionTypeCode&quot;,actionReason);
					orderItemDetails.SetProperty(&quot;Order_id&quot;,orderID);
					orderItemDetails.SetProperty(&quot;msisdn&quot;,msisdn);
					orderItemDetails.SetProperty(&quot;Name&quot;,orderLineItemBusComp.GetFieldValue(&quot;Account&quot;));
					orderItemList.AddChild(orderItemDetails);
					errorCode = &quot;Succes&quot;;
					errorDescription = &quot;&quot;;
					statusCode = &quot;0&quot;;
					
				//	recordItem = orderLineItemBusComp.NextRecord();
				}
				record = orderBusComp.NextRecord();
			}
			if(statusCode == &quot;0&quot;){
				orderItem.AddChild(orderItemList);
				Outputs.AddChild(orderItem);
			}
		}
		if(errorCode == &quot;SBL-ROW&quot; &amp;&amp; (isTaxNum)){
			errorCode = &quot;SBL-TAX&quot;;
			errorDescription = &quot;No Row Returned for tax number!&quot;;			
		}
		Outputs.SetProperty (&quot;StatusCode&quot;, statusCode);
		Outputs.SetProperty (&quot;ErrorCode&quot;, errorCode);
		Outputs.SetProperty (&quot;ErrorDescription&quot;, errorDescription);		
	}
	catch(e){
		statusCode = &quot;1&quot;
		errorCode = &quot;SBL-UNXPTD&quot;;
		errorDescription = &quot;An unexpected Internal Siebel error occured!&quot;;
		
		Outputs.SetProperty (&quot;StatusCode&quot;, statusCode);
		Outputs.SetProperty (&quot;ErrorCode&quot;, errorCode);
		Outputs.SetProperty (&quot;ErrorDescription&quot;, errorDescription);		
	}
	
	finally{
		record = null;
		msisdn = null;
		shop_code = null;
		tax_number = null;
		billing_account = null;
		checkEligibility = null;
		errorCode = null;
		errorDescription = null;
		statusCode = null;
		orderSearchSpec = null;
		orderItemSearchSpec = null;
		twoDays = null;
		twoDayBefore = null;
		orderID = null;
		actionReason  = null;
		
		orderOpen = null;
		orderFailed = null;
		orderCompleted = null;	
		
		orderBusObject = null;
		orderBusComp = null;
		
		inProp = null;
		outProp	= null;
		bsDateTime = null;
		
		orderLineItemBusComp = null;
	}

}"
			   SEQUENCE="2"
			   UPDATED="04/10/2018 23:04:12"
			   UPDATED_BY="IBM_BAKIG"
			   CREATED="04/10/2018 11:44:01"
			   CREATED_BY="IBM_BAKIG">
			</BUSINESS_SERVICE_SERVER_SCRIPT>
			<BUSINESS_SERVICE_SERVER_SCRIPT
			   INACTIVE="N"
			   NAME="Service_PreInvokeMethod"
			   PROGRAM_LANGUAGE="JS"
			   SCRIPT="function Service_PreInvokeMethod (MethodName, Inputs, Outputs)
{
	if (MethodName == &quot;GetOrderTransData&quot;)
	{
		GetOrderTransData (Inputs, Outputs);
		return (CancelOperation);
	}

	return (ContinueOperation);
}"
			   SEQUENCE="3"
			   UPDATED="04/10/2018 11:44:01"
			   UPDATED_BY="IBM_BAKIG"
			   CREATED="04/10/2018 11:44:01"
			   CREATED_BY="IBM_BAKIG">
			</BUSINESS_SERVICE_SERVER_SCRIPT>
			<BUSINESS_SERVICE_SERVER_SCRIPT
			   INACTIVE="N"
			   NAME="getFormatDate"
			   PROGRAM_LANGUAGE="JS"
			   SCRIPT="function getFormatDate(){
	var dDate = new Date();
	var sMonth = ToString(dDate.getMonth() + 1);
	if (sMonth.length == 1) {sMonth = &quot;0&quot; + sMonth;}
	var sDay = ToString(dDate.getDate());
	if (sDay.length == 1) {sDay = &quot;0&quot; + sDay;}
	
	
	return (  sMonth  +&quot;/&quot; +sDay +&quot;/&quot;+ dDate.getFullYear());
}"
			   SEQUENCE="1"
			   UPDATED="04/10/2018 11:44:01"
			   UPDATED_BY="IBM_BAKIG"
			   CREATED="04/10/2018 11:44:01"
			   CREATED_BY="IBM_BAKIG">
			</BUSINESS_SERVICE_SERVER_SCRIPT>
		</BUSINESS_SERVICE>
	</PROJECT>
</REPOSITORY>



